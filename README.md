# Malanta.ai API Evaluation Scripts

This repository contains two Python scripts designed to evaluate the efficacy and capabilities of the Malanta.ai threat intelligence API.

1.  **Company Report Generator**: A script for single-entity reconnaissance, gathering a wide range of intelligence on a specific company.
2.  **Feed Efficacy Analyzer**: An advanced tool for performing a large-scale, multi-faceted evaluation of the API's detection and enrichment capabilities against a known threat feed.

---
## Prerequisites

Before running these scripts, ensure you have the following installed:

* **Python 3.7+**
* **Required Python libraries**: `requests`, `pandas`, and `tqdm`. You can install them using pip:
    ```bash
    pip install requests pandas tqdm
    ```

---
## Configuration

### API Key

Both scripts require a Malanta.ai API key to function. The most secure way to provide the key is by setting an environment variable named `MALANTA_API_KEY`.

**On macOS/Linux:**
```bash
export MALANTA_API_KEY="yourapikey"
```

**On Windows (Command Prompt):**
```bash
set MALANTA_API_KEY="yourapikey"
```

Alternatively, you can pass the key directly using the `-k` or `--api-key` command-line argument, though this is less secure.

---
## Scripts

### 1. Company Report Generator (`company_analyzer.py`)

This script generates a broad intelligence report on a single company by querying dozens of different API endpoints for information related to its domains, certificates, infrastructure, and potential security exposures.

#### **Usage**
```bash
python company_analyzer.py -c <company_name> -d <company_domain> [-o <output_file.txt>]
```

**Example:**
```bash
python company_analyzer.py -c "OPSWAT" -d "opswat.com" -o "opswat_report.txt"
```

#### **Sample Report Output**
```text
================================================================================
      Cybersecurity Intelligence Report for: OPSWAT
      Generated by Malanta.ai API
================================================================================

--- Company Supply Chain ---
[
  {
    "vendor": "Cloudflare",
    "category": "CDN & Security"
  }
]
--------------------------------------------------------------------------------

--- Vulnerable For Hijack Sub Domains ---
[
  {
    "subdomain": "promo.opswat.com",
    "vulnerability_type": "Dangling CNAME",
    "risk_level": "Critical"
  }
]
--------------------------------------------------------------------------------
```

### 2. Feed Efficacy Analyzer (`feed_analyzer.py`)

This is an advanced, multi-threaded tool for performing a deep evaluation of the Malanta.ai API's efficacy against a known XML threat feed. It goes beyond simple hit/miss checks to provide nuanced metrics on detection, intelligence uplift, and enrichment.

#### **Key Features**

* **Verdict-Aware Analysis**: Differentiates between IOCs from high-confidence (`MALICIOUS`) and low-confidence (`UNKNOWN`) reports to calculate both a standard **Detection Rate** and a **Sandbox Efficacy Uplift Rate**.
* **Intelligence Enrichment**: After finding initial hits, it pivots on the returned `cluster_id`s to discover a network of related indicators that were not in the original feed.
* **Outlier Cluster Filtering**: Includes a `--cluster-threshold` to automatically ignore massive, noisy clusters (e.g., from shared CDNs) for a more accurate enrichment score.
* **Detailed, Multi-Part Reporting**: Generates a comprehensive report with examples of hits/misses, cluster details, and enrichment statistics.

#### **Usage**
```bash
python feed_analyzer.py <feed_file.xml> [options]
```
**Options:**
* `-t`, `--threads`: Number of parallel threads for API queries (default: 10).
* `--cluster-threshold`: Ignore clusters larger than this size to reduce noise (default: 1000).
* `-o`, `--output`: File path to save the clean report.

**Example:**
```bash
python feed_analyzer.py "reports_feed.xml" -t 20 --cluster-threshold 500 -o "efficacy_report.txt"
```

#### **Sample Report Output**
```text
================================================================================
Malanta.ai API Efficacy Report
Source Feed: reports_feed.xml
================================================================================

## Efficacy Against High-Confidence IOCs ##
  - Total Indicators in this Category: 450
  - Detected by Malanta.ai: 398
  - Detection Rate (Recall): 88.44%

  --- Examples ---
  Detected Domains: evil-domain.com, malware-c2.net, ...
  Missed Domains:   missed-phish.org, ...
  Detected IPs:     198.51.100.12, 192.0.2.100, ...
  Missed IPs:       203.0.113.50, ...

## Sandbox Efficacy Uplift (Low-Confidence IOCs) ##
  - Total Indicators in this Category: 800
  - Detected by Malanta.ai: 412
  - Efficacy Uplift Rate: 51.50%

  --- Examples ---
  Detected Domains: unknown-domain.com, suspicious-site.net, ...
  Missed Domains:   unverified.org, ...
  Detected IPs:     1.1.1.1, 8.8.8.8, ...
  Missed IPs:       1.0.0.1, ...

## Intelligence Enrichment Summary ##
  - Cluster Size Threshold: >500 members (ignored)
  - Noisy Clusters Ignored: 5
  - Total New Indicators Discovered: 4122
    (From 198 relevant clusters)

  --- Examples of New Indicators ---
    - newly-found-malware-domain.com
    - related-c2-ip-2.com
    - 198.51.100.201

## Detected Indicator & Cluster Details ##
  - IOC: evil-domain.com (Parent Report Verdict: MALICIOUS) -> Cluster IDs: cl_1a2b3c4d5e
  - IOC: 1.1.1.1 (Parent Report Verdict: UNKNOWN) -> Cluster IDs: cl_6f7g8h9i0j, cl_x1y2z3a4b
```